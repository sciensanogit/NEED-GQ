---
title: "NEED project"
subtitle: "Sub-analyses"
author: "Alexandre Bohyn"
output: officedown::rdocx_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r load-packages}
library(officedown)
library(officer)
library(tidyverse)
library(here)
library(labelled)
library(gtsummary)
library(flextable)
library(glue)
```

```{r group-data}
# Load the processed data
data <- readRDS(here("data/processed/data_fr.rds"))

# Define the variables of interest for the sub-analyses
df_lbl <- data |>
  filter(included == 1) |>
  select(
    id,
    gender = D2,
    time_since_diag = D13,
    diagnosis = DSD1_A1,
    birthyear = D3,
    province = D4,
    living_situation = D6,
    involvement = HC11,
    education = D5,
    finance = D12
  )

# Recode some variables into less categories
group <- df_lbl |>
  mutate(
    gender = remove_val_labels(gender) |>
      factor(levels = c(1, 2), labels = c("Male", "Female")),
    time_since_diag = case_match(
      time_since_diag,
      c(1, 2, 3, 4) ~ 0,
      5 ~ 1,
      6 ~ NA
    ) |>
      factor(levels = c(0, 1), labels = c("< 10 years", "10+ years")),
    age = (2024 - birthyear) |>
      cut(
        breaks = c(0, 24, 65, Inf),
        labels = c("< 25", "25-65", "65+"),
        right = TRUE
      ),
    diagnosis = remove_val_labels(diagnosis) |>
      factor(
        levels = c(1, 2),
        labels = c("Schizophrenia", "Other")
      ),
    region = remove_val_labels(province) |>
      case_match(
        c(1, 6, 9, 10, 11) ~ "Flanders",
        3 ~ "Brussels",
        c(2, 4, 5, 7, 8) ~ "Wallonia"
      ) |>
      factor(levels = c("Flanders", "Brussels", "Wallonia")),
    living_situation = case_match(
      remove_val_labels(living_situation),
      c(1, 2) ~ "Alone",
      c(3:11) ~ "With others"
    ) |>
      factor(levels = c("Alone", "With others")),
    involvement = case_match(
      remove_val_labels(involvement),
      c(1, 2) ~ "Yes",
      c(3:5) ~ "No"
    ) |>
      factor(levels = c("Yes", "No")),
    education = case_match(
      remove_val_labels(education),
      1 ~ "Basic",
      c(2, 3) ~ "Secondary",
      c(4, 5, 6) ~ "Higher"
    ) |>
      factor(levels = c("Basic", "Secondary", "Higher")),
    finance = case_match(
      remove_val_labels(finance),
      c(1:3) ~ "Easy",
      c(4:6) ~ "Hard",
    ) |>
      factor(levels = c("Easy", "Hard"))
  ) |>
  select(-birthyear, -province) |>
  # Add labels to the variables
  set_variable_labels(
    id = "Participant",
    gender = "Gender",
    time_since_diag = "Time since diagnosis",
    diagnosis = "Diagnosis",
    age = "Age (years)",
    region = "Region",
    living_situation = "Living situation",
    involvement = "Involvement in care",
    education = "Education level",
    finance = "Financial situation"
  )
```

```{r variable-data, cache=FALSE}
# List all variable data set in "processed/subdata"
data_files <- fs::dir_ls(here::here("data/processed/subdata"), glob = "*.rds")

# Read all data files into a named list
data_list <- lapply(data_files, readRDS)

# Join each data to the group data
df <- group
for (i in seq_along(data_list)) {
  name <- data_files[[i]] |> fs::path_file() |> fs::path_ext_remove()
  # cli::cli_alert_info("Joining data: {name}")
  df <- df |>
    dplyr::left_join(data_list[[i]], by = "id")
  # cli::cli_text("\t - New dimensions: {dim(df)[1]} rows, {dim(df)[2]} columns\n")
}
```

```{r fn-tbl_one_var_cont}
tbl_one_var_cont <- function(data, group_var, var, var_lab) {
  pre_lab <- pull(group, {{ group_var }}) |> attr("label")
  lab <- paste0("**", pre_lab, "**")
  # Count the number of non-missing observations in the grouping variables
  df <- data |>
    filter(!is.na({{ group_var }}))
  n_total <- nrow(df)
  # Count the number of non-missing observations in the variables to summarize
  df2 <- df |> filter(!is.na({{ var }}))
  n_vars <- nrow(df2)
  # Generate a message about the number of observations used, to use as a footnote
  msg <- glue(
    "Out of {n_total} participants with non-missing values in the grouping variable ({pre_lab}), {n_vars} had non-missing values in the summarized variable ({var_lab}), and were included in the analysis."
  )
  df |>
    set_variable_labels({{ var }} := var_lab) |>
    tbl_summary(
      by = {{ group_var }},
      include = {{ var }},
      type = everything() ~ "continuous2",
      statistic = all_continuous2() ~
        c("{mean} ({sd})", "{median} ({p25}, {p75})", "{min}, {max}"),
      digits = everything() ~ 1,
      missing_text = "Missing"
    ) |>
    add_overall() |>
    modify_spanning_header(all_stat_cols() ~ lab) |>
    modify_footnote_spanning_header(
      footnote = msg,
      columns = all_stat_cols()
    ) |>
    add_p() |>
    as_flex_table() |>
    width(j = 1, width = 4, unit = "cm") |>
    width(j = -1, width = 3, unit = "cm")
}
```

```{r fn-tbl-one-var-categ}
tbl_one_var_categ <- function(data, group_var, var, var_lab) {
  # Define the label for the grouping variable
  pre_lab <- pull(data, {{ group_var }}) |> attr("label")
  lab <- paste0("**", pre_lab, "**")
  # Count the number of non-missing observations in the grouping variables
  df <- data |>
    filter(!is.na({{ group_var }}))
  n_total <- nrow(df)
  # Count the number of non-missing observations in the variables to summarize
  df2 <- df |> filter(!is.na({{ var }}))
  n_vars <- nrow(df2)
  # Generate a message about the number of observations used, to use as a footnote
  msg <- glue(
    "Out of {n_total} participants with non-missing values in the grouping variable ({pre_lab}), {n_vars} had non-missing values in the summarized variable, and were included in the analysis."
  )
  # Generate the summary table
  df |>
    set_variable_labels({{ var }} := var_lab) |>
    tbl_summary(
      by = {{ group_var }},
      include = {{ var }},
      missing_text = "Missing"
    ) |>
    add_overall() |>
    add_p(
      test = everything() ~ "fisher.test",
      test.args = all_tests("fisher.test") ~ list(simulate.p.value = TRUE)
    ) |>
    modify_spanning_header(all_stat_cols() ~ lab) |>
    modify_footnote_spanning_header(
      footnote = msg,
      columns = all_stat_cols()
    ) |>
    as_flex_table() |>
    width(j = 1, width = 5, unit = "cm") |>
    width(j = -1, width = 3, unit = "cm")
}
```

```{r fn-tbl_mult_var_dicho}
tbl_mult_var_dicho <- function(data, group_var, vars_match) {
  # Define the label for the grouping variable
  pre_lab <- pull(group, {{ group_var }}) |> attr("label")
  lab <- paste0("**", pre_lab, "**")
  # Count the number of non-missing observations in the grouping variables
  df <- data |>
    filter(!is.na({{ group_var }}))
  n_total <- nrow(df)
  # Count the number of non-missing observations in the variables to summarize
  df2 <- df |> filter(if_any(starts_with(vars_match), ~ !is.na(.x)))
  n_vars <- nrow(df2)
  # Generate a message about the number of observations used, to use as a footnote
  msg <- glue(
    "Out of {n_total} participants with non-missing values in the grouping variable ({pre_lab}), {n_vars} had non-missing values in at least one of the summarized variables, and were included in the analysis."
  )

  # Create the summary table
  df2 |>
    mutate(across(starts_with(vars_match), ~ if_else(is.na(.x), 0, .x))) |>
    tbl_summary(
      by = {{ group_var }},
      include = starts_with(vars_match),
      type = everything() ~ "dichotomous",
      value = everything() ~ "1",
      missing_text = "Missing"
    ) |>
    add_overall() |>
    modify_spanning_header(all_stat_cols() ~ lab) |>
    modify_footnote_spanning_header(
      footnote = msg,
      columns = all_stat_cols()
    ) |>
    add_p() |>
    as_flex_table() |>
    width(j = 1, width = 4, unit = "cm") |>
    width(j = -1, width = 3, unit = "cm")
}
```

```{r fn-tbl_mult_var_cont}
tbl_mult_var_cont <- function(data, group_var, vars_match) {
  # Define the label for the grouping variable
  pre_lab <- pull(group, {{ group_var }}) |> attr("label")
  lab <- paste0("**", pre_lab, "**")
  # Count the number of non-missing observations in the grouping variables
  df <- data |>
    filter(!is.na({{ group_var }}))
  n_total <- nrow(df)
  # Count the number of non-missing observations in the variables to summarize
  df2 <- df |> filter(if_any(starts_with(vars_match), ~ !is.na(.x)))
  n_vars <- nrow(df2)
  # Generate a message about the number of observations used, to use as a footnote
  msg <- glue(
    "Out of {n_total} participants with non-missing values in the grouping variable ({pre_lab}), {n_vars} had non-missing values in at least one of the summarized variables, and were included in the analysis."
  )

  # Create the summary table
  df2 |>
    tbl_summary(
      by = {{ group_var }},
      include = starts_with(vars_match),
      type = everything() ~ "continuous2",
      statistic = all_continuous2() ~
        c("{mean} ({sd})", "{median} ({p25}, {p75})", "{min}, {max}"),
      digits = everything() ~ 0,
      missing_text = "Missing"
    ) |>
    add_overall() |>
    modify_spanning_header(all_stat_cols() ~ lab) |>
    modify_footnote_spanning_header(
      footnote = msg,
      columns = all_stat_cols()
    ) |>
    add_p() |>
    as_flex_table() |>
    width(j = 1, width = 4, unit = "cm") |>
    width(j = -1, width = 3, unit = "cm")
}
```

# Table of content

```{r toc}
block_toc()
```

\newpage

```{r, tab.id="tbl-patient-characteristics"}
#| tab.cap = "Patient characteristics"

tbl_summary(
  group,
  include = c(
    gender,
    time_since_diag,
    diagnosis,
    age,
    region,
    living_situation,
    involvement,
    education,
    finance
  ),
  missing_text = "Missing"
) |>
  bold_labels() |>
  as_flex_table()
```

\newpage

# Health 

## General health-related quality of life (HRQoL)

```{r, tab.id="tbl-hrqol-time"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by time since diagnosis"

tbl_one_var_cont(
  df,
  time_since_diag,
  eq5d5l_health_score,
  "EQ-5D health score difference"
)
```

\newpage

```{r, tab.id="tbl-hrqol-diag"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by diagnosis"

tbl_one_var_cont(
  df,
  diagnosis,
  eq5d5l_health_score,
  "EQ-5D health score difference"
)
```

\newpage

```{r, tab.id="tbl-hrqol-gender"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by gender"

tbl_one_var_cont(
  df,
  gender,
  eq5d5l_health_score,
  "EQ-5D health score difference"
)
```

\newpage

```{r, tab.id="tbl-hrqol-education"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by education"

tbl_one_var_cont(
  df,
  education,
  eq5d5l_health_score,
  "EQ-5D health score difference"
)
```

\newpage

```{r, tab.id="tbl-hrqol-finance"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by financial situation"

tbl_one_var_cont(
  df,
  finance,
  eq5d5l_health_score,
  "EQ-5D health score difference"
)
```

\newpage

```{r, tab.id="tbl-hrqol-age"}
#| tab.cap = "Difference EQ-5D before onset of the symptoms vs today by age"

tbl_one_var_cont(df, age, eq5d5l_health_score, "EQ-5D health score difference")
```

\newpage

## Physical health 

### Burden of physical symptoms

```{r, tab.id="tbl-burden-phys-time"}
#| tab.cap = "Burden of physical symptoms by time since diagnosis"

tbl_mult_var_cont(df, time_since_diag, "HC5_SQ")
```

\newpage

```{r, tab.id="tbl-burden-phys-gender"}
#| tab.cap = "Burden of physical symptoms by gender"

tbl_mult_var_cont(df, gender, "HC5_SQ")
```

\newpage

```{r, tab.id="tbl-burden-phys-education"}
#| tab.cap = "Burden of physical symptoms by education"

tbl_mult_var_cont(df, education, "HC5_SQ")
```

\newpage

```{r, tab.id="tbl-burden-phys-finance"}
#| tab.cap = "Burden of physical symptoms by financial situation"

tbl_mult_var_cont(df, finance, "HC5_SQ")
```

\newpage

```{r, tab.id="tbl-burden-phys-diag"}
#| tab.cap = "Burden of physical symptoms by diagnosis"

tbl_mult_var_cont(df, diagnosis, "HC5_SQ")
```

\newpage

```{r, tab.id="tbl-burden-phys-age"}
#| tab.cap = "Burden of physical symptoms by age"

tbl_mult_var_cont(df, age, "HC5_SQ")
```

\newpage

### Pain/discomfort

```{r, tab.id="tbl-pain-gender"}
#| tab.cap = "Pain/discomfort by gender"

tbl_one_var_cont(df, gender, eq5d5l_pain_discomfort, "Pain/discomfort")
```

\newpage

```{r, tab.id="tbl-pain-age"}
#| tab.cap = "Pain/discomfort by age"

tbl_one_var_cont(df, age, eq5d5l_pain_discomfort, "Pain/discomfort")
```

\newpage

```{r, tab.id="tbl-pain-education"}
#| tab.cap = "Pain/discomfort by education"

tbl_one_var_cont(df, education, eq5d5l_pain_discomfort, "Pain/discomfort")
```

\newpage

```{r, tab.id="tbl-pain-finance"}
#| tab.cap = "Pain/discomfort by financial situation"

tbl_one_var_cont(df, finance, eq5d5l_pain_discomfort, "Pain/discomfort")
```

\newpage

## Psychological health

### Burden of psychological symptoms 

```{r, tab.id="tbl-burden-psych-time"}
#| tab.cap = "Burden of psychological symptoms by time since diagnosis"

tbl_mult_var_cont(df, time_since_diag, "H13_SQ")
```

\newpage

```{r, tab.id="tbl-burden-psych-age"}
#| tab.cap = "Burden of psychological symptoms by age"

tbl_mult_var_cont(df, age, "H13_SQ")
```

\newpage

```{r, tab.id="tbl-burden-psych-diagnosis"}
#| tab.cap = "Burden of psychological symptoms by diagnosis"

tbl_mult_var_cont(df, diagnosis, "H13_SQ")
```

\newpage

```{r, tab.id="tbl-burden-psych-gender"}
#| tab.cap = "Burden of psychological symptoms by gender"

tbl_mult_var_cont(df, gender, "H13_SQ")
```

\newpage

```{r, tab.id="tbl-burden-psych-education"}
#| tab.cap = "Burden of psychological symptoms by education"

tbl_mult_var_cont(df, education, "H13_SQ")
```

\newpage

```{r, tab.id="tbl-burden-psych-finance"}
#| tab.cap = "Burden of psychological symptoms by financial situation"

tbl_mult_var_cont(df, finance, "H13_SQ")
```

### Anxiety/depression

```{r, tab.id="tbl-anxiety-gender"}
#| tab.cap = "Anxiety/depression by gender"

tbl_one_var_cont(df, gender, eq5d5l_anxiety_depression, "Anxiety/depression")
```

\newpage

```{r, tab.id="tbl-anxiety-age"}
#| tab.cap = "Anxiety/depression by age"

tbl_one_var_cont(df, age, eq5d5l_anxiety_depression, "Anxiety/depression")
```

\newpage

```{r, tab.id="tbl-anxiety-education"}
#| tab.cap = "Anxiety/depression by education"

tbl_one_var_cont(df, education, eq5d5l_anxiety_depression, "Anxiety/depression")
```

\newpage

```{r, tab.id="tbl-anxiety-finance"}
#| tab.cap = "Anxiety/depression by financial situation"

tbl_one_var_cont(df, finance, eq5d5l_anxiety_depression, "Anxiety/depression")
```

\newpage

## Autonomy

### Mobility

```{r, tab.id="tbl-mobility-gender"}
#| tab.cap = "Mobility by gender"

tbl_one_var_cont(df, gender, eq5_mobility, "Mobility")
```

\newpage

```{r, tab.id="tbl-mobility-age"}
#| tab.cap = "Mobility by age"

tbl_one_var_cont(df, age, eq5_mobility, "Mobility")
```

\newpage

```{r, tab.id="tbl-mobility-education"}
#| tab.cap = "Mobility by education"

tbl_one_var_cont(df, education, eq5_mobility, "Mobility")
```

\newpage

```{r, tab.id="tbl-mobility-finance"}
#| tab.cap = "Mobility by financial situation"

tbl_one_var_cont(df, finance, eq5_mobility, "Mobility")
```

\newpage

### Self-care

```{r, tab.id="tbl-self-care-gender"}
#| tab.cap = "Self-care by gender"

tbl_one_var_cont(df, gender, eq5_self_care, "Self-care")
```

\newpage

```{r, tab.id="tbl-self-care-age"}
#| tab.cap = "Self-care by age"

tbl_one_var_cont(df, age, eq5_self_care, "Self-care")
```

\newpage

```{r, tab.id="tbl-self-care-education"}
#| tab.cap = "Self-care by education"

tbl_one_var_cont(df, education, eq5_self_care, "Self-care")
```

\newpage

```{r, tab.id="tbl-self-care-finance"}
#| tab.cap = "Self-care by financial situation"

tbl_one_var_cont(df, finance, eq5_self_care, "Self-care")
```

\newpage

### Usual activities

```{r, tab.id="tbl-usual-activities-gender"}
#| tab.cap = "Usual activities by gender"

tbl_one_var_cont(df, gender, eq5d5l_usual_activities, "Usual activities")
```

\newpage

```{r, tab.id="tbl-usual-activities-age"}
#| tab.cap = "Usual activities by age"

tbl_one_var_cont(df, age, eq5d5l_usual_activities, "Usual activities")
```

\newpage

```{r, tab.id="tbl-usual-activities-education"}
#| tab.cap = "Usual activities by education"

tbl_one_var_cont(df, education, eq5d5l_usual_activities, "Usual activities")
```

\newpage

```{r, tab.id="tbl-usual-activities-finance"}
#| tab.cap = "Usual activities by financial situation"

tbl_one_var_cont(df, finance, eq5d5l_usual_activities, "Usual activities")
```

\newpage

## Reproductive health 

```{r, tab.id="tbl-reproductive-health-gender"}
#| tab.cap = "Reproductive health by gender"

tbl_one_var_cont(df, gender, reproductive_health, "Reproductive health")
```

\newpage

```{r, tab.id="tbl-reproductive-health-age"}
#| tab.cap = "Reproductive health by age"

tbl_one_var_cont(df, age, reproductive_health, "Reproductive health")
```

\newpage

```{r, tab.id="tbl-reproductive-health-education"}
#| tab.cap = "Reproductive health by education"

tbl_one_var_cont(df, education, reproductive_health, "Reproductive health")
```

\newpage

```{r, tab.id="tbl-reproductive-health-finance"}
#| tab.cap = "Reproductive health by financial situation"

tbl_one_var_cont(df, finance, reproductive_health, "Reproductive health")
```

\newpage

## Sexual health 

```{r, tab.id="tbl-sexual-health-gender"}
#| tab.cap = "Sexual health by gender"

tbl_one_var_cont(df, gender, sexual_health, "Sexual health")
```

\newpage

```{r, tab.id="tbl-sexual-health-age"}
#| tab.cap = "Sexual health by age"

tbl_one_var_cont(df, age, sexual_health, "Sexual health")
```

\newpage

```{r, tab.id="tbl-sexual-health-education"}
#| tab.cap = "Sexual health by education"

tbl_one_var_cont(df, education, sexual_health, "Sexual health")
```

\newpage

```{r, tab.id="tbl-sexual-health-finance"}
#| tab.cap = "Sexual health by financial situation"

tbl_one_var_cont(df, finance, sexual_health, "Sexual health")
```

\newpage

# Healthcare

## Treatment use 

```{r, tab.id="tbl-treatment-use-time"}
#| tab.cap = "Treatment use by time since diagnosis"

tbl_mult_var_dicho(df, time_since_diag, "HC3_SQ")
```

\newpage

```{r, tab.id="tbl-treatment-use-diag"}
#| tab.cap = "Treatment use by diagnosis"

tbl_mult_var_dicho(df, diagnosis, "HC3_SQ")
```

\newpage

```{r, tab.id="tbl-treatment-use-gender"}
#| tab.cap = "Treatment use by gender"

tbl_mult_var_dicho(df, gender, "HC3_SQ")
```

\newpage

```{r, tab.id="tbl-treatment-use-age"}
#| tab.cap = "Treatment use by age"

tbl_mult_var_dicho(df, age, "HC3_SQ")
```

\newpage

```{r, tab.id="tbl-treatment-use-education"}
#| tab.cap = "Treatment use by education"

tbl_mult_var_dicho(df, education, "HC3_SQ")
```

\newpage

```{r, tab.id="tbl-treatment-use-finance"}
#| tab.cap = "Treatment use by financial situation"

tbl_mult_var_dicho(df, finance, "HC3_SQ")
```

\newpage

## Burden of the treatment 

```{r, tab.id="tbl-burden-treatment-time"}
#| tab.cap = "Burden of the treatment by time since diagnosis"

tbl_mult_var_dicho(df, time_since_diag, "HC4_SQ")
```

\newpage

```{r, tab.id="tbl-burden-treatment-gender"}
#| tab.cap = "Burden of the treatment by gender"

tbl_mult_var_dicho(df, gender, "HC4_SQ")
```

\newpage

```{r, tab.id="tbl-burden-treatment-age"}
#| tab.cap = "Burden of the treatment by age"

tbl_mult_var_dicho(df, age, "HC4_SQ")
```

\newpage

```{r, tab.id="tbl-burden-treatment-involvement"}
#| tab.cap = "Burden of the treatment by involvement in treatment decisions"

tbl_mult_var_dicho(df, involvement, "HC4_SQ")
```

## Quality of care

### Satisfaction with organization of care

```{r, tab.id="tbl-satisfaction-organization-region"}
#| tab.cap = "Satisfaction with organization of care by geographical region"

tbl_one_var_cont(
  df,
  region,
  HC7,
  "Satisfaction with organization of care"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-organization-gender"}
#| tab.cap = "Satisfaction with organization of care by gender"

tbl_one_var_cont(
  df,
  gender,
  HC7,
  "Satisfaction with organization of care"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-organization-age"}
#| tab.cap = "Satisfaction with organization of care by age"

tbl_one_var_cont(
  df,
  age,
  HC7,
  "Satisfaction with organization of care"
)
```

\newpage
```{r, tab.id="tbl-satisfaction-organization-education"}
#| tab.cap = "Satisfaction with organization of care by education"

tbl_one_var_cont(
  df,
  education,
  HC7,
  "Satisfaction with organization of care"
)
```

\newpage
```{r, tab.id="tbl-satisfaction-organization-finance"}
#| tab.cap = "Satisfaction with organization of care by financial situation"

tbl_one_var_cont(
  df,
  finance,
  HC7,
  "Satisfaction with organization of care"
)
```

\newpage

### Recurence of same healthcare personel

```{r, tab.id="tbl-reccurence-hcp-region"}
#| tab.cap = "Recurence of same healthcare personel by geographical region"

tbl_one_var_cont(
  df,
  region,
  HC9,
  "Recurence of same healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-reccurence-hcp-gender"}
#| tab.cap = "Recurence of same healthcare personel by gender"

tbl_one_var_cont(
  df,
  gender,
  HC9,
  "Recurence of same healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-reccurence-hcp-age"}
#| tab.cap = "Recurence of same healthcare personel by age"

tbl_one_var_cont(
  df,
  age,
  HC9,
  "Recurence of same healthcare personel"
)
```

\newpage
```{r, tab.id="tbl-reccurence-hcp-education"}
#| tab.cap = "Recurence of same healthcare personel by education"

tbl_one_var_cont(
  df,
  education,
  HC9,
  "Recurence of same healthcare personel"
)
```

\newpage
```{r, tab.id="tbl-reccurence-hcp-finance"}
#| tab.cap = "Recurence of same healthcare personel by financial situation"

tbl_one_var_cont(
  df,
  finance,
  HC9,
  "Recurence of same healthcare personel"
)
```

\newpage

### Statisfaction with information received from HCP

```{r, tab.id="tbl-satisfaction-info-hcp-region"}
#| tab.cap = "Satisfaction with information received from healthcare personel by geographical region"

tbl_one_var_cont(
  df,
  region,
  hcp_information_satisfaction,
  "Satisfaction with information received from healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-info-hcp-gender"}
#| tab.cap = "Satisfaction with information received from healthcare personel by gender"

tbl_one_var_cont(
  df,
  gender,
  hcp_information_satisfaction,
  "Satisfaction with information received from healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-info-hcp-age"}
#| tab.cap = "Satisfaction with information received from healthcare personel by age"

tbl_one_var_cont(
  df,
  age,
  hcp_information_satisfaction,
  "Satisfaction with information received from healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-info-hcp-education"}
#| tab.cap = "Satisfaction with information received from healthcare personel by education"

tbl_one_var_cont(
  df,
  education,
  hcp_information_satisfaction,
  "Satisfaction with information received from healthcare personel"
)
```

\newpage

```{r, tab.id="tbl-satisfaction-info-hcp-finance"}
#| tab.cap = "Satisfaction with information received from healthcare personel by financial situation"

tbl_one_var_cont(
  df,
  finance,
  hcp_information_satisfaction,
  "Satisfaction with information received from healthcare personel"
)
```

\newpage

### Involvement in treatment choice

```{r, tab.id="tbl-trt-choice-involvement-region"}
#| tab.cap = "Involvement in treatment choice by geographical region"

tbl_one_var_cont(
  df,
  region,
  treatment_choice_involvement,
  "Involvement in treatment choice"
)
```

\newpage

```{r, tab.id="tbl-trt-choice-involvement-gender"}
#| tab.cap = "Involvement in treatment choice by gender"

tbl_one_var_cont(
  df,
  gender,
  treatment_choice_involvement,
  "Involvement in treatment choice"
)
```

\newpage

```{r, tab.id="tbl-trt-choice-involvement-age"}
#| tab.cap = "Involvement in treatment choice by age"

tbl_one_var_cont(
  df,
  age,
  treatment_choice_involvement,
  "Involvement in treatment choice"
)
```

\newpage

```{r, tab.id="tbl-trt-choice-involvement-education"}
#| tab.cap = "Involvement in treatment choice by education"

tbl_one_var_cont(
  df,
  education,
  treatment_choice_involvement,
  "Involvement in treatment choice"
)
```

\newpage

```{r, tab.id="tbl-trt-choice-involvement-finance"}
#| tab.cap = "Involvement in treatment choice by financial situation"

tbl_one_var_cont(
  df,
  finance,
  treatment_choice_involvement,
  "Involvement in treatment choice"
)
```

\newpage

## Diagnostic timing 

### Time between first symptoms and decision to search care

```{r, tbl.id="tbl-time-symptoms-decision-region"}
#| tab.cap = "Time between first symptoms and decision to search care (DSHC1) by region"

tbl_one_var_categ(
  df,
  region,
  time_to_symp,
  "Time between first symptoms and decision to search care"
)
```

\newpage

```{r, tbl.id="tbl-time-symptoms-decision-gender"}
#| tab.cap = "Time between first symptoms and decision to search care (DSHC1) by gender"

tbl_one_var_categ(
  df,
  gender,
  time_to_symp,
  "Time between first symptoms and decision to search care"
)
```

\newpage

```{r, tbl.id="tbl-time-symptoms-decision-age"}
#| tab.cap = "Time between first symptoms and decision to search care (DSHC1) by age"

tbl_one_var_categ(
  df,
  age,
  time_to_symp,
  "Time between first symptoms and decision to search care"
)
```

\newpage

```{r, tbl.id="tbl-time-symptoms-decision-education"}
#| tab.cap = "Time between first symptoms and decision to search care (DSHC1) by education"

tbl_one_var_categ(
  df,
  education,
  time_to_symp,
  "Time between first symptoms and decision to search care"
)
```

\newpage

```{r, tbl.id="tbl-time-symptoms-decision-finance"}
#| tab.cap = "Time between first symptoms and decision to search care (DSHC1) by financial situation"

tbl_one_var_categ(
  df,
  finance,
  time_to_symp,
  "Time between first symptoms and decision to search care"
)
```

### Time between first appointment and diagnosis 

```{r, tbl.id="tbl-time-first-app-diagnosis-region"}
#| tab.cap = "Time between first symptoms and diagnosis (D13) by region"

tbl_one_var_categ(
  df,
  region,
  time_to_diagnosis,
  "Time between first appointment and diagnosis"
)
```

### Time between diagnosis and treatment

```{r, tbl.id="tbl-time-diagnosis-treatment-region"}
#| tab.cap = "Time between diagnosis and treatment (HC1) by region"

tbl_one_var_categ(
  df,
  region,
  time_to_hc,
  "Time between diagnosis and treatment"
)
```

\newpage

```{r, tbl.id="tbl-time-diagnosis-treatment-gender"}
#| tab.cap = "Time between diagnosis and treatment (HC1) by gender"

tbl_one_var_categ(
  df,
  gender,
  time_to_hc,
  "Time between diagnosis and treatment"
)
```

\newpage

```{r, tbl.id="tbl-time-diagnosis-treatment-age"}
#| tab.cap = "Time between diagnosis and treatment (HC1) by age"

tbl_one_var_categ(
  df,
  age,
  time_to_hc,
  "Time between diagnosis and treatment"
)
```

\newpage

```{r, tbl.id="tbl-time-diagnosis-treatment-education"}
#| tab.cap = "Time between diagnosis and treatment (HC1) by education"

tbl_one_var_categ(
  df,
  education,
  time_to_hc,
  "Time between diagnosis and treatment"
)
```

\newpage

```{r, tbl.id="tbl-time-diagnosis-treatment-finance"}
#| tab.cap = "Time between diagnosis and treatment (HC1) by financial situation"

tbl_one_var_categ(
  df,
  finance,
  time_to_hc,
  "Time between diagnosis and treatment"
)
```


## Accessibility of treatment

### Forgone care

```{r, tab.id="tbl-forgone-care-region"}
#| tab.cap = "Forgone care by region"

tbl_mult_var_dicho(df, region, "HC13_SQ")
```

\newpage

```{r, tab.id="tbl-forgone-care-gender"}
#| tab.cap = "Forgone care by gender"

tbl_mult_var_dicho(df, gender, "HC13_SQ")
```

\newpage

```{r, tab.id="tbl-forgone-care-age"}
#| tab.cap = "Forgone care by age"

tbl_mult_var_dicho(df, age, "HC13_SQ")
```

\newpage

```{r, tab.id="tbl-forgone-care-education"}
#| tab.cap = "Forgone care by education"

tbl_mult_var_dicho(df, education, "HC13_SQ")
```

\newpage

```{r, tab.id="tbl-forgone-care-finance"}
#| tab.cap = "Forgone care by financial situation"

tbl_mult_var_dicho(df, finance, "HC13_SQ")
```


# Social 

## Social support needs

```{r, tab.id="tbl-social-support-region"}
#| tab.cap = "Social support needs by region"

tbl_mult_var_dicho(df, region, "S7_SQ")
```

\newpage

```{r, tab.id="tbl-social-support-gender"}
#| tab.cap = "Social support needs by gender"

tbl_mult_var_dicho(df, gender, "S7_SQ")
```

\newpage

```{r, tab.id="tbl-social-support-age"}
#| tab.cap = "Social support needs by age"

tbl_mult_var_dicho(df, age, "S7_SQ")
```

\newpage

```{r, tab.id="tbl-social-support-education"}
#| tab.cap = "Social support needs by education"

tbl_mult_var_dicho(df, education, "S7_SQ")
```

\newpage

```{r, tab.id="tbl-social-support-finance"}
#| tab.cap = "Social support needs by financial situation"

tbl_mult_var_dicho(df, finance, "S7_SQ")
```

\newpage

## Social connection needs

```{r, tab.id="tbl-impact-personal-relations-gender"}
#| tab.cap = "Impact on personal relations by gender"

tbl_one_var_cont(
  df,
  gender,
  impact_personal_relations,
  "Impact on personal relations"
)
```

\newpage

```{r, tab.id="tbl-impact-personal-relations-age"}
#| tab.cap = "Impact on personal relations by age"

tbl_one_var_cont(
  df,
  age,
  impact_personal_relations,
  "Impact on personal relations"
)
```

\newpage

```{r, tab.id="tbl-impact-personal-relations-education"}
#| tab.cap = "Impact on personal relations by education"

tbl_one_var_cont(
  df,
  education,
  impact_personal_relations,
  "Impact on personal relations"
)
```

\newpage

```{r, tab.id="tbl-impact-personal-relations-finance"}
#| tab.cap = "Impact on personal relations by financial situation"

tbl_one_var_cont(
  df,
  finance,
  impact_personal_relations,
  "Impact on personal relations"
)
```

\newpage

## Education 

```{r, tab.id="tbl-impact-education-gender"}
#| tab.cap = "Impact on education by gender"

tbl_one_var_cont(df, gender, impact_education, "Impact on education")
```

\newpage

```{r, tab.id="tbl-impact-education-age"}
#| tab.cap = "Impact on education by age"

tbl_one_var_cont(df, age, impact_education, "Impact on education")
```

\newpage

```{r, tab.id="tbl-impact-education-education"}
#| tab.cap = "Impact on education by education"

tbl_one_var_cont(df, education, impact_education, "Impact on education")
```

\newpage

```{r, tab.id="tbl-impact-education-finance"}
#| tab.cap = "Impact on education by financial situation"

tbl_one_var_cont(df, finance, impact_education, "Impact on education")
```

\newpage

## Work 

### Impact on work intensity 

```{r, tab.id="tbl-impact-work-time-since-diag"}
#| tab.cap = "Impact on work intensity by time since diagnosis"

tbl_one_var_categ(df, time_since_diag, impact_work, "Impact on work intensity")

tbl_summary(
  df,
  by = time_since_diag,
  include = impact_work,
  label = list(impact_work = "Impact on work intensity"),
  missing_text = "Missing"
) |>
  add_p() |>
  modify_spanning_header(all_stat_cols() ~ "**Time since diagnosis**") |>
  as_flex_table() |>
  width(j = 1, width = 5, unit = "cm") |>
  width(j = -1, width = 3, unit = "cm")
```

\newpage

```{r, tab.id="tbl-impact-work-living-situation"}
#| tab.cap = "Impact on work intensity by living situation"

tbl_one_var_categ(df, living_situation, impact_work, "Impact on work intensity")
```

\newpage

```{r, tab.id="tbl-impact-work-gender"}
#| tab.cap = "Impact on work intensity by gender"

tbl_one_var_categ(df, gender, impact_work, "Impact on work intensity")
```

\newpage

```{r, tab.id="tbl-impact-work-education"}
#| tab.cap = "Impact on work intensity by education"

tbl_one_var_categ(df, education, impact_work, "Impact on work intensity")
```

\newpage

```{r, tab.id="tbl-impact-work-finance"}
#| tab.cap = "Impact on work intensity by financial situation"

tbl_one_var_categ(df, finance, impact_work, "Impact on work intensity")
```

\newpage

### Time of incapacity to work

```{r, tab.id="tbl-impact-time-work-time-since-diag"}
#| tab.cap = "Impact on work intensity by time since diagnosis"

tbl_one_var_categ(df, time_since_diag, time_not_working, "Time not working")
```

\newpage

```{r, tab.id="tbl-impact-time-work-living-situation"}
#| tab.cap = "Impact on work intensity by living situation"

tbl_one_var_categ(df, living_situation, time_not_working, "Time not working")
```

\newpage

```{r, tab.id="tbl-impact-time-work-gender"}
#| tab.cap = "Impact on work intensity by gender"

tbl_one_var_categ(df, gender, time_not_working, "Time not working")
```

\newpage

```{r, tab.id="tbl-impact-time-work-education"}
#| tab.cap = "Impact on work intensity by education"

tbl_one_var_categ(df, education, time_not_working, "Time not working")
```

\newpage

```{r, tab.id="tbl-impact-time-work-finance"}
#| tab.cap = "Impact on work intensity by financial situation"

tbl_one_var_categ(df, finance, time_not_working, "Time not working")
```

## Financial consequences

```{r, tab.id="tbl-impact-financial-living-situation"}
#| tab.cap = "Impact on financial situation by living situation"

tbl_one_var_cont(
  df,
  living_situation,
  impact_financial_situation,
  "Impact on financial situation"
)
```

\newpage

```{r, tab.id="tbl-impact-financial-time-since-diag"}
#| tab.cap = "Impact on financial situation by time since diagnosis"

tbl_one_var_cont(
  df,
  time_since_diag,
  impact_financial_situation,
  "Impact on financial situation"
)
```

\newpage

```{r, tab.id="tbl-impact-financial-age"}
#| tab.cap = "Impact on financial situation by age"

tbl_one_var_cont(
  df,
  age,
  impact_financial_situation,
  "Impact on financial situation"
)
```

\newpage

```{r, tab.id="tbl-impact-financial-gender"}
#| tab.cap = "Impact on financial situation by gender"

tbl_one_var_cont(
  df,
  gender,
  impact_financial_situation,
  "Impact on financial situation"
)
```

\newpage

```{r, tab.id="tbl-impact-financial-education"}
#| tab.cap = "Impact on financial situation by education"

tbl_one_var_cont(
  df,
  education,
  impact_financial_situation,
  "Impact on financial situation"
)
```

\newpage

```{r, tab.id="tbl-impact-financial-finance"}
#| tab.cap = "Impact on financial situation by financial situation"

tbl_one_var_cont(
  df,
  finance,
  impact_financial_situation,
  "Impact on financial situation"
)
```

# Priotity rating of need categories (P1)

```{r, tab.id="tbl-priority-time-since-diag"}
#| tab.cap = "Priority ratings by time since diagnosis"

tbl_mult_var_cont(df, time_since_diag, "P1")
```

\newpage

```{r, tab.id="tbl-priority-living-situation"}
#| tab.cap = "Priority ratings by living situation"

tbl_mult_var_cont(df, living_situation, "P1")
```

\newpage

```{r, tab.id="tbl-priority-gender"}
#| tab.cap = "Priority ratings by gender"

tbl_mult_var_cont(df, gender, "P1")
```

\newpage

```{r, tab.id="tbl-priority-education"}
#| tab.cap = "Priority ratings by education"

tbl_mult_var_cont(df, education, "P1")
```

\newpage

```{r, tab.id="tbl-priority-finance"}
#| tab.cap = "Priority ratings by financial situation"

tbl_mult_var_cont(df, finance, "P1")
```

\newpage

```{r, tab.id="tbl-priority-region"}
#| tab.cap = "Priority ratings by geographical region"

tbl_mult_var_cont(df, region, "P1")
```

\newpage

```{r, tab.id="tbl-priority-age"}
#| tab.cap = "Priority ratings by age"

tbl_mult_var_cont(df, age, "P1")
```
